<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SY496B9L99"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SY496B9L99');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC: Running</title>
<meta name=”keywords” content="exascale, fluid dynamics, cfd, computational fluid dynamics, compressible, hpc, bryngelson, colonius, subgrid, multiphase, frontier, summit, el capitan, aurora, amd gpu, gpu, nvidia"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
// This file is set as MATHJAX_CODEFILE in the Doxyfile. It configures how
// MathJax renders expressions in Markdown so that it is consistent with GitHub.
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath:  [ ['$',  '$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      ignoreClass: "line" // Ignore code blocks: https://web.archive.org/web/20120430100225/http://www.mathjax.org/docs/1.1/options/tex2jax.html
    },
    "HTML-CSS": {
      fonts: ["TeX"]
    }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC
   </div>
   <div id="projectbrief">High-fidelity multiphase flow simulation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('running.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Running </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 class="doxsection"><a class="anchor" id="autotoc_md381"></a>
Running</h1>
<p>MFC can be run using <span class="tt">mfc.sh</span>'s <span class="tt">run</span> command. It supports interactive and batch execution. Batch mode is designed for multi-node distributed systems (supercomputers) equipped with a scheduler such as PBS, SLURM, or LSF. A full (and up-to-date) list of available arguments can be acquired with <span class="tt">./mfc.sh run -h</span>.</p>
<p>MFC supports running simulations locally (Linux, MacOS, and Windows) as well as several supercomputer clusters, both interactively and through batch submission.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md382"></a>
Using the Homebrew package (macOS)</h2>
<p>If you installed MFC via Homebrew, run cases with the <span class="tt">mfc</span> wrapper:</p>
<div class="fragment"><div class="line">mfc &lt;path/to/case.py&gt; -n 2</div>
</div><!-- fragment --><ul>
<li>Use <span class="tt">-n X</span> to control the number of MPI processes (ranks).</li>
<li>The Homebrew package uses a simplified syntax: just <span class="tt">mfc &lt;case.py&gt;</span> to run cases.</li>
<li>To use developer commands (<span class="tt">build</span>, <span class="tt">test</span>, <span class="tt">clean</span>, etc.), clone the repository and use <span class="tt">./mfc.sh</span>.</li>
<li>The wrapper passes through runtime flags like <span class="tt">-t pre_process simulation</span>, <span class="tt">-n</span>, and others; it always runs with preinstalled binaries.</li>
<li>Examples live at <span class="tt">$(brew --prefix mfc)/examples/</span>.</li>
</ul>
<dl class="section important"><dt>Important</dt><dd>Running simulations locally should work out of the box. On supported clusters, you can append <span class="tt">-c &lt;computer name&gt;</span> on the command line to instruct the MFC toolchain to make use of the template file <span class="tt">toolchain/templates/&lt;computer name&gt;.mako</span>. You can browse that directory and contribute your own files. Since systems and their schedulers do not have a standardized syntax to request certain resources, MFC can only provide support for a restricted subset of common or user-contributed configuration options. <br  />
<br  />
 Adding a new template file or modifying an existing one will most likely be required if:<ul>
<li>You are on a cluster that does not have a template yet.</li>
<li>Your cluster is configured with SLURM, but interactive job launches fail when using <span class="tt">srun</span>. You might need to invoke <span class="tt">mpirun</span> instead.</li>
<li>Something in the existing default or computer template file is incompatible with your system or does not provide a feature you need. <br  />
<br  />
 If <span class="tt">-c &lt;computer name&gt;</span> is left unspecified, it defaults to <span class="tt">-c default</span>.</li>
</ul>
</dd></dl>
<p>Please refer to <span class="tt">./mfc.sh run -h</span> for a complete list of arguments and options, along with their defaults.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md384"></a>
Interactive Execution</h2>
<p>To run all stages of MFC, that is <a href="https://github.com/MFlowCode/MFC/tree/master/src/pre_process/">pre_process</a>, <a href="https://github.com/MFlowCode/MFC/tree/master/src/simulation/">simulation</a>, and <a href="https://github.com/MFlowCode/MFC/tree/master/src/post_process/">post_process</a> on the sample case <a href="https://github.com/MFlowCode/MFC/tree/master/examples/2D_shockbubble/">2D_shockbubble</a>,</p>
<div class="fragment"><div class="line">./mfc.sh run examples/2D_shockbubble/case.py</div>
</div><!-- fragment --><p>If you want to run a subset of the available stages, you can use the <span class="tt">-t</span> argument. To use multiple threads, use the <span class="tt">-n</span> option along with the number of threads you wish to use. If a (re)build is required, it will be done automatically, with the number of threads specified with the <span class="tt">-j</span> option.</p>
<p>For example,</p>
<ul>
<li>Running <a href="https://github.com/MFlowCode/MFC/tree/master/src/pre_process/">pre_process</a> with 2 cores:</li>
</ul>
<div class="fragment"><div class="line">./mfc.sh run examples/2D_shockbubble/case.py -t pre_process -n 2</div>
</div><!-- fragment --><ul>
<li>Running <a href="https://github.com/MFlowCode/MFC/tree/master/src/simulation/">simulation</a> and <a href="https://github.com/MFlowCode/MFC/tree/master/src/post_process/">post_process</a> using 4 cores:</li>
</ul>
<div class="fragment"><div class="line">./mfc.sh run examples/2D_shockbubble/case.py -t simulation post_process -n 4</div>
</div><!-- fragment --><hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md386"></a>
Running on GPUs</h2>
<p>MFC supports GPU acceleration via OpenACC (default) or OpenMP offloading. This section covers how to build and run MFC on GPU systems.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md387"></a>
Building with GPU Support</h3>
<p>First, build MFC with GPU support enabled:</p>
<div class="fragment"><div class="line"># Using OpenACC (default, recommended for NVIDIA)</div>
<div class="line">./mfc.sh build --gpu</div>
<div class="line"> </div>
<div class="line"># Explicitly specify OpenACC</div>
<div class="line">./mfc.sh build --gpu acc</div>
<div class="line"> </div>
<div class="line"># Using OpenMP offloading (alternative)</div>
<div class="line">./mfc.sh build --gpu mp</div>
</div><!-- fragment --><p>On HPC clusters, load the appropriate modules first:</p>
<div class="fragment"><div class="line">source ./mfc.sh load -c &lt;cluster&gt; -m g   # &#39;g&#39; for GPU mode</div>
<div class="line">./mfc.sh build --gpu -j $(nproc)</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md388"></a>
Running on GPUs</h3>
<p>Run simulations with GPU support:</p>
<div class="fragment"><div class="line"># Basic GPU run</div>
<div class="line">./mfc.sh run case.py --gpu</div>
<div class="line"> </div>
<div class="line"># Specify GPU IDs (useful for multi-GPU nodes)</div>
<div class="line">./mfc.sh run case.py --gpu -g 0 1 2 3</div>
<div class="line"> </div>
<div class="line"># Run with 4 MPI ranks (typically one per GPU)</div>
<div class="line">./mfc.sh run case.py -n 4 --gpu</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md389"></a>
Supported Compilers</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Vendor  </th><th class="markdownTableHeadNone">Compiler  </th><th class="markdownTableHeadNone">OpenACC  </th><th class="markdownTableHeadNone">OpenMP  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">NVIDIA  </td><td class="markdownTableBodyNone">NVHPC (nvfortran)  </td><td class="markdownTableBodyNone">Yes  </td><td class="markdownTableBodyNone">Yes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">AMD  </td><td class="markdownTableBodyNone">Cray (ftn)  </td><td class="markdownTableBodyNone">Yes  </td><td class="markdownTableBodyNone">Yes  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AMD  </td><td class="markdownTableBodyNone">AMD (amdflang)  </td><td class="markdownTableBodyNone">No  </td><td class="markdownTableBodyNone">Yes  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="autotoc_md390"></a>
Environment Setup</h3>
<p>Most HPC systems require loading GPU-specific modules:</p>
<p><b>NVIDIA systems:</b> </p><div class="fragment"><div class="line">module load nvhpc cuda</div>
<div class="line"># Or use MFC&#39;s module loader:</div>
<div class="line">source ./mfc.sh load -c phoenix -m g</div>
</div><!-- fragment --><p><b>AMD systems:</b> </p><div class="fragment"><div class="line">module load rocm amdflang</div>
<div class="line"># Or use MFC&#39;s module loader:</div>
<div class="line">source ./mfc.sh load -c frontier -m g</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md391"></a>
Verifying GPU Detection</h3>
<p>Check that GPUs are visible before running:</p>
<div class="fragment"><div class="line"># NVIDIA</div>
<div class="line">nvidia-smi</div>
<div class="line"> </div>
<div class="line"># AMD</div>
<div class="line">rocm-smi</div>
</div><!-- fragment --><p>To force GPU usage (fails fast if no GPU available): </p><div class="fragment"><div class="line">export OMP_TARGET_OFFLOAD=MANDATORY</div>
<div class="line">./mfc.sh run case.py --gpu</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md392"></a>
GPU Profiling</h3>
<p>MFC integrates with vendor profiling tools for performance analysis.</p>
<h4 class="doxsection"><a class="anchor" id="autotoc_md393"></a>
NVIDIA GPUs</h4>
<p><b>Nsight Systems</b> (timeline/system-level profiling): </p><div class="fragment"><div class="line">./mfc.sh run case.py -t simulation --nsys [nsys flags]</div>
</div><!-- fragment --><ul>
<li>Best for understanding execution order and timing of major subroutines (WENO, Riemann, etc.)</li>
<li>Generates <span class="tt">.nsys-rep</span> files in the case directory</li>
<li>Open with <a href="https://developer.nvidia.com/nsight-systems/get-started">NVIDIA Nsight Systems GUI</a></li>
<li>Use few timesteps to keep report files small</li>
</ul>
<p><b>Nsight Compute</b> (kernel-level profiling): </p><div class="fragment"><div class="line">./mfc.sh run case.py -t simulation --ncu [ncu flags]</div>
</div><!-- fragment --><ul>
<li>Detailed per-kernel metrics: cycles, memory usage, occupancy</li>
<li>Significantly slower than normal execution</li>
<li>Use only with few timesteps</li>
</ul>
<h4 class="doxsection"><a class="anchor" id="autotoc_md394"></a>
AMD GPUs</h4>
<p><b>rocprof-systems</b> (timeline profiling): </p><div class="fragment"><div class="line">./mfc.sh run case.py -t simulation --rsys --hip-trace [rocprof flags]</div>
</div><!-- fragment --><ul>
<li>Generates files viewable in <a href="https://ui.perfetto.dev/">Perfetto UI</a></li>
<li>Use few timesteps for manageable file sizes</li>
</ul>
<p><b>rocprof-compute</b> (kernel-level profiling): </p><div class="fragment"><div class="line">./mfc.sh run case.py -t simulation --rcu -n &lt;name&gt; [rocprof-compute flags]</div>
</div><!-- fragment --><ul>
<li>Provides rooflines, cache usage, register usage</li>
<li>Runs the executable multiple times (moderately slower)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Place profiling arguments at the end of the command so their flags can be appended.</dd></dl>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md396"></a>
Batch Execution</h2>
<p>The MFC detects which scheduler your system is using and handles the creation and execution of batch scripts. Use batch mode for running on HPC clusters with job schedulers (SLURM, PBS, LSF).</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md397"></a>
Basic Usage</h3>
<div class="fragment"><div class="line">./mfc.sh run case.py -e batch -N 2 -n 4 -c &lt;computer&gt;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md398"></a>
Batch Options</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option  </th><th class="markdownTableHeadNone">Long Form  </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">-e batch</span>  </td><td class="markdownTableBodyNone"><span class="tt">--engine batch</span>  </td><td class="markdownTableBodyNone">Enable batch submission (required)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">-N</span>  </td><td class="markdownTableBodyNone"><span class="tt">--nodes</span>  </td><td class="markdownTableBodyNone">Number of nodes to request  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">-n</span>  </td><td class="markdownTableBodyNone"><span class="tt">--tasks-per-node</span>  </td><td class="markdownTableBodyNone">MPI ranks per node  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">-w</span>  </td><td class="markdownTableBodyNone"><span class="tt">--walltime</span>  </td><td class="markdownTableBodyNone">Maximum job time (HH:MM:SS)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">-a</span>  </td><td class="markdownTableBodyNone"><span class="tt">--account</span>  </td><td class="markdownTableBodyNone">Account/allocation to charge  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">-p</span>  </td><td class="markdownTableBodyNone"><span class="tt">--partition</span>  </td><td class="markdownTableBodyNone">Queue/partition name  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">-q</span>  </td><td class="markdownTableBodyNone"><span class="tt">--qos</span>  </td><td class="markdownTableBodyNone">Quality of service level  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">-@</span>  </td><td class="markdownTableBodyNone"><span class="tt">--email</span>  </td><td class="markdownTableBodyNone">Email for job notifications  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">-#</span>  </td><td class="markdownTableBodyNone"><span class="tt">--name</span>  </td><td class="markdownTableBodyNone">Job name (default: MFC)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">-c</span>  </td><td class="markdownTableBodyNone"><span class="tt">--computer</span>  </td><td class="markdownTableBodyNone">Submission template to use  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="autotoc_md399"></a>
Examples</h3>
<p><b>Basic 4-node job:</b> </p><div class="fragment"><div class="line">./mfc.sh run case.py -e batch -N 4 -n 8 -w 02:00:00</div>
</div><!-- fragment --><p><b>Job with account and email:</b> </p><div class="fragment"><div class="line">./mfc.sh run case.py -e batch -N 2 -a myproject -@ user@example.com</div>
</div><!-- fragment --><p><b>GPU job on Frontier:</b> </p><div class="fragment"><div class="line">./mfc.sh run case.py -e batch -N 4 -n 8 -c frontier --gpu -w 01:00:00</div>
</div><!-- fragment --><p><b>Dry run (preview script without submitting):</b> </p><div class="fragment"><div class="line">./mfc.sh run case.py -e batch -N 2 --dry-run</div>
</div><!-- fragment --><p><b>Wait for job completion:</b> </p><div class="fragment"><div class="line">./mfc.sh run case.py -e batch -N 2 --wait</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md400"></a>
Computer Templates</h3>
<p>MFC includes pre-configured templates in <span class="tt">toolchain/templates/</span> for many clusters. Use <span class="tt">-c &lt;name&gt;</span> to select one:</p>
<div class="fragment"><div class="line">./mfc.sh run case.py -e batch -c phoenix   # Georgia Tech Phoenix</div>
<div class="line">./mfc.sh run case.py -e batch -c frontier  # OLCF Frontier</div>
<div class="line">./mfc.sh run case.py -e batch -c delta     # NCSA Delta</div>
</div><!-- fragment --><p>If no template exists for your cluster, use <span class="tt">-c default</span> and customize as needed, or contribute a new template.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md401"></a>
Scheduler Notes</h3>
<p><b>SLURM systems:</b> Most clusters use SLURM. MFC automatically generates appropriate <span class="tt">sbatch</span> scripts.</p>
<p><b>LSF systems (e.g., Summit):</b> IBM's JSRUN does not use the traditional node-based approach. MFC constructs equivalent resource sets for task and GPU counts.</p>
<hr  />
<p><a class="anchor" id="restarting-cases"></a> </p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md403"></a>
Restarting Cases</h2>
<p>When running a simulation, MFC generates a <span class="tt">./restart_data</span> folder in the case directory that contains <span class="tt">lustre_*.dat</span> files that can be used to restart a simulation from saved timesteps. This allows a user to simulate some timestep $X$, then continue it to run to another timestep $Y$, where $Y &gt; X$. The user can also choose to add new patches at the intermediate timestep.</p>
<p>If you want to restart a simulation,</p>
<ul>
<li>For a simulation that uses a constant time step set up the initial case file with:<ul>
<li><span class="tt">t_step_start</span> : $t_i$</li>
<li><span class="tt">t_step_stop</span> : $t_f$</li>
<li><span class="tt">t_step_save</span> : $SF$ in which $t_i$ is the starting time, $t_f$ is the final time, and $SF$ is the saving frequency time. For a simulation that uses adaptive time-stepping, set up the initial case file with:</li>
<li><span class="tt">n_start</span> : $t_i$</li>
<li><span class="tt">t_stop</span> : $t_f$</li>
<li><span class="tt">t_save</span> : $SF$ in which $t_i$ is the starting time, $t_f$ is the final time, and $SF$ is the saving frequency time.</li>
</ul>
</li>
<li>Run <span class="tt">pre_process</span> and <span class="tt">simulation</span> on the case.<ul>
<li><span class="tt">./mfc.sh run case.py -t pre_process simulation </span></li>
</ul>
</li>
<li>As the simulation runs, Lustre files will be created for each saved timestep in <span class="tt">./restart_data</span>.</li>
<li>When the simulation stops, choose any Lustre file as the restarting point (lustre_ $t_s$.dat)</li>
<li>Create a new duplicate input file (e.g., <span class="tt">restart_case.py</span>), which should have:</li>
</ul>
<ol type="1">
<li>For the Computational Domain Parameters<ul>
<li>Have the following removed <b>except</b> <span class="tt">m</span>, <span class="tt">n</span>, and <span class="tt">p</span>:<ul>
<li>All domain/mesh information<ul>
<li><span class="tt">(xyz)_domainbeg</span></li>
<li><span class="tt">(xyz)_domainend</span></li>
<li><span class="tt">stretch_(xyz)</span></li>
<li><span class="tt">a_(xyz)</span></li>
<li><span class="tt">(xyz)_a</span></li>
<li><span class="tt">(xyz)_b</span></li>
</ul>
</li>
</ul>
</li>
<li><p class="startli">When using a constant time-step, alter the following:</p><ul>
<li><span class="tt">t_step_start</span> : $t_s$ (the point at which the simulation will restart)</li>
<li><span class="tt">t_step_stop</span> : $t_{f2}$ (new final simulation time, which can be the same as $t_f$)</li>
<li><span class="tt">t_step_save</span> : ${SF}_2$ (if interested in changing the saving frequency)</li>
</ul>
<p class="startli">If using a CFL-based time-step, alter the following:</p><ul>
<li><span class="tt">n_start</span> : $t_s$ (the save file at which the simulation will restart)</li>
<li><span class="tt">t_stop</span> : $t_{f2}$ (new final simulation time, which can be the same as $t_f$)</li>
<li><span class="tt">t_save</span> : ${SF}_2$ (if interested in changing the saving frequency)</li>
</ul>
</li>
<li>Add the following:<ul>
<li><span class="tt">old_ic</span> : 'T' (to specify that we have initial conditions from previous simulations)</li>
<li><span class="tt">old_grid</span> : 'T' (to specify that we have a grid from previous simulations)</li>
<li><span class="tt">t_step_old</span> : $t_i$ (the time step used as the <span class="tt">t_step_start</span> of the original <span class="tt">case.py</span> file)</li>
</ul>
</li>
</ul>
</li>
<li>For the Simulation Algorithm Parameters<ul>
<li>Substitute <span class="tt">num_patches</span> to reflect the number of ADDED patches in the <span class="tt">restart_case.py</span> file. If no patches are added, set <span class="tt">num_patches: 0</span></li>
</ul>
</li>
<li>For Patches<ul>
<li>Have all information about old patches (used in the <span class="tt">case.py</span> file) removed.<ul>
<li><span class="tt">patch_icpp(1)all variables</span></li>
<li><span class="tt">patch_icpp(2)all variables</span></li>
<li><span class="tt">patch_icpp(num_patches)all variables</span></li>
</ul>
</li>
<li>Add information about new patches that will be introduced, if any. The parameter num_patches should reflect this addition.<ul>
<li>e.g. <span class="tt">patch_icpp(1)some variables of interest</span></li>
</ul>
</li>
</ul>
</li>
<li>For Fluid properties<ul>
<li>Keep information about the fluid properties</li>
</ul>
</li>
</ol>
<ul>
<li>Run pre-process and simulation on <span class="tt">restart_case.py</span><ul>
<li><span class="tt">./mfc.sh run restart_case.py -t pre_process simulation </span></li>
</ul>
</li>
<li>Run the post_process<ul>
<li>There are several ways to do this. Keep in mind that, regardless of the .py file used, the post_process command will generate output files in the [<span class="tt">t_step_start</span>, <span class="tt">t_step_stop</span>] range, with <span class="tt">t_step_save</span> as the spacing between files.</li>
<li>One way is to set <span class="tt">t_step_stop</span> to the restarting point $t_s$ in <span class="tt">case.py</span>. Then, run the commands below. The first command will run on timesteps $[t_i, t_s]$. The second command will run on $[t_s, t_{f2}]$. Therefore, the whole range $[t_i, t_{f2}]$ will be post-processed.</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">./mfc.sh run case.py -t post_process</div>
<div class="line">./mfc.sh run restart_case.py -t post_process</div>
</div><!-- fragment --><p>We have provided an example, <span class="tt">case.py</span> and <span class="tt">restart_case.py</span> in <span class="tt">/examples/1D_vacuum_restart/</span>. This simulation is a duplicate of the <span class="tt">1D_vacuum</span> case. It demonstrates stopping at timestep 7000, adding a new patch, and restarting the simulation. To test this code, run:</p>
<div class="fragment"><div class="line">./mfc.sh run examples/1D_vacuum_restart/case.py -t pre_process simulation</div>
<div class="line">./mfc.sh run examples/1D_vacuum_restart/restart_case.py -t pre_process simulation</div>
<div class="line">./mfc.sh run examples/1D_vacuum_restart/case.py -t post_process</div>
<div class="line">./mfc.sh run examples/1D_vacuum_restart/restart_case.py -t post_process</div>
</div><!-- fragment --><hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md405"></a>
Example Runs</h2>
<ul>
<li>Oak Ridge National Laboratory's <a href="https://www.olcf.ornl.gov/summit/">Summit</a>:</li>
</ul>
<div class="fragment"><div class="line">./mfc.sh run examples/2D_shockbubble/case.py -e batch \</div>
<div class="line">               -N 2 -n 4 -t simulation -a &lt;redacted&gt; -c summit</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
