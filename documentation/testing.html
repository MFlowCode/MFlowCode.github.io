<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SY496B9L99"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SY496B9L99');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC: Testing</title>
<meta name="description" content="Testing â€” MFC documentation. Open-source exascale multiphase flow solver." />
<meta name="keywords" content="exascale, fluid dynamics, cfd, computational fluid dynamics, compressible, hpc, bryngelson, colonius, subgrid, multiphase, frontier, summit, el capitan, aurora, amd gpu, gpu, nvidia"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
// This file is set as MATHJAX_CODEFILE in the Doxyfile. It configures how
// MathJax renders expressions in Markdown so that it is consistent with GitHub.
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath:  [ ['$',  '$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      ignoreClass: "line" // Ignore code blocks: https://web.archive.org/web/20120430100225/http://www.mathjax.org/docs/1.1/options/tex2jax.html
    },
    "HTML-CSS": {
      fonts: ["TeX"]
    }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC
   </div>
   <div id="projectbrief">Exascale flow solver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('testing.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Testing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2 class="doxsection"><a class="anchor" id="autotoc_md458"></a>
Testing</h2>
<p>To run MFC's test suite, run </p><div class="fragment"><div class="line">./mfc.sh test -j &lt;thread count&gt;</div>
</div><!-- fragment --><p>It will generate and run test cases, comparing their output to previous runs from versions of MFC considered accurate. <em>golden files</em>, stored in the <span class="tt">tests/</span> directory contain this data, aggregating <span class="tt">.dat</span> files generated when running MFC. A test is considered passing when our error tolerances are met in order to maintain a high level of stability and accuracy. <span class="tt">./mfc.sh test</span> has the following unique options:</p><ul>
<li><span class="tt">-l</span> outputs the full list of tests</li>
<li><span class="tt">--from</span> (<span class="tt">-f)</span> and <span class="tt">--to</span> (<span class="tt">t</span>) restrict testing to a range of contiguous slugs</li>
<li><span class="tt">--only</span> (<span class="tt">-o</span>) restricts testing to a non-contiguous range of tests based on if their trace contains a certain feature</li>
<li><span class="tt">--test-all</span> (<span class="tt">a</span>) test post process and ensure the Silo database files are correct</li>
<li><span class="tt">--percent</span> (<span class="tt">%</span>) to specify a percentage of the test suite to select at random and test</li>
<li><span class="tt">--max-attempts</span> (<span class="tt">-m</span>) the maximum number of attempts to make on a test before considering it failed</li>
<li><span class="tt">--no-examples</span> skips the testing of cases in the examples folder</li>
<li><span class="tt">--rdma-mpi</span> runs additional tests where RDMA MPI is enabled.</li>
</ul>
<p>To specify a computer, pass the <span class="tt">-c</span> flag to <span class="tt">./mfc.sh run</span> like so: </p><div class="fragment"><div class="line">./mfc.sh test -j &lt;thread count&gt; -- -c &lt;computer name&gt;</div>
</div><!-- fragment --><p> where <span class="tt">&lt;computer name&gt;</span> could be <span class="tt">phoenix</span> or any of the others in the <a href="https://github.com/MFlowCode/MFC/tree/master/toolchain/templates">templates</a>). You can create new templates with the appropriate run commands or omit this option. The use of <span class="tt">--</span> in the above command passes options to the <span class="tt">./mfc.sh run</span> command underlying the <span class="tt">./mfc.sh test</span>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md459"></a>
Creating Tests</h3>
<p>Creating and updating test cases can be done with the following command line arguments:</p><ul>
<li><span class="tt">--generate</span> to generate golden files for a new test case</li>
<li><span class="tt">--add-new-variables</span> to similar to <span class="tt">--generate</span>, but rather than generating a golden file from scratch, it generates a gold file with new variables for an updated test without changing the original golden file values.</li>
<li><span class="tt">--remove-old-tests</span> to remove the directories of tests that no longer exist</li>
</ul>
<p>It is recommended that a range be specified when generating golden files for new test cases, as described in the previous section, in an effort not to regenerate the golden files of existing test cases.</p>
<p>Adding a new test case can be done by modifying <a href="https://github.com/MFlowCode/MFC/tree/master/toolchain/mfc/test/cases.py">cases.py</a>. The function <span class="tt">list_cases</span> is responsible for generating the list of test cases. Loops and conditionals are used to vary parameters, whose defaults can be found in the <span class="tt">BASE_CFG</span> case object within <a href="https://github.com/MFlowCode/MFC/tree/master/toolchain/mfc/test/case.py">case.py</a>. The function operates on two variables:</p>
<ul>
<li><span class="tt">stack</span>: A stack that holds the variations to the default case parameters. By pushing and popping the stack inside loops and conditionals, it is easier to nest test case descriptions, as it holds the variations that are common to all future test cases within the same indentation level (in most scenarios).</li>
<li><span class="tt">cases</span>: A list that holds fully-formed <span class="tt">Case</span> objects, that will be returned at the end of the function.</li>
</ul>
<p>Internally a test case is described as: </p><div class="fragment"><div class="line"><span class="preprocessor">@dataclasses.dataclass(init=False)</span></div>
<div class="line"><span class="keyword">class </span>Case:</div>
<div class="line">    trace:  str</div>
<div class="line">    params: dict</div>
<div class="line">    ppn:    int</div>
</div><!-- fragment --><p>where:</p><ul>
<li>The <span class="tt">trace</span> is a string that contains a human-readable description of what parameters were varied, or more generally what the case is meant to test. <b>Each <span class="tt">trace</span> must be distinct.</b></li>
<li><span class="tt">params</span> is the fully resolved case dictionary, as would appear in a Python case input file.</li>
<li><span class="tt">ppn</span> is the number of processes per node to use when running the case.</li>
</ul>
<p>To illustrate, consider the following excerpt from <span class="tt">list_cases</span>:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> weno_order <span class="keywordflow">in</span> [3, 5]:</div>
<div class="line">  stack.push(f<span class="stringliteral">&quot;weno_order={weno_order}&quot;</span>, {<span class="stringliteral">&#39;weno_order&#39;</span>: weno_order})</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> mapped_weno, mp_weno <span class="keywordflow">in</span> [(<span class="stringliteral">&#39;F&#39;</span>, <span class="stringliteral">&#39;F&#39;</span>), (<span class="stringliteral">&#39;T&#39;</span>, <span class="stringliteral">&#39;F&#39;</span>), (<span class="stringliteral">&#39;F&#39;</span>, <span class="stringliteral">&#39;T&#39;</span>)]:</div>
<div class="line">      stack.push(f<span class="stringliteral">&quot;(mapped_weno={mapped_weno},mp_weno={mp_weno})&quot;</span>, {</div>
<div class="line">          <span class="stringliteral">&#39;mapped_weno&#39;</span>: mapped_weno,</div>
<div class="line">          <span class="stringliteral">&#39;mp_weno&#39;</span>:     mp_weno</div>
<div class="line">      })</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> <span class="keywordflow">not</span> (mp_weno == <span class="stringliteral">&#39;T&#39;</span> <span class="keywordflow">and</span> weno_order != 5):</div>
<div class="line">          cases.append(define_case_d(stack, <span class="stringliteral">&#39;&#39;</span>, {}))</div>
<div class="line"> </div>
<div class="line">      stack.pop()</div>
<div class="line"> </div>
<div class="line">  stack.pop()</div>
</div><!-- fragment --><p>When pushing to the stack or creating a new case with the <span class="tt">define_case_d</span> function, you must specify:</p><ul>
<li><span class="tt">stack</span>: The current stack.</li>
<li><span class="tt">trace</span>: A human-readable string describing what you are currently varying.</li>
<li><span class="tt">variations</span>: A Python dictionary with case parameter variations.</li>
<li>(Optional) <span class="tt">ppn</span>: The number of processes per node to use (default is 1).</li>
</ul>
<p>If a trace is empty (that is, the empty string <span class="tt">""</span>), it will not appear in the final trace, but any case parameter variations associated with it will still be applied.</p>
<p>Finally, the case is appended to the <span class="tt">cases</span> list, which will be returned by the <span class="tt">list_cases</span> function.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md460"></a>
Testing Post Process</h3>
<p>To test the post-processing code, append the <span class="tt">-a</span> or <span class="tt">--test-all</span> option: </p><div class="fragment"><div class="line">./mfc.sh test -a -j 8</div>
</div><!-- fragment --><p>This argument will re-run the test stack with <span class="tt">parallel_io='T'</span>, which generates silo_hdf5 files. It will also turn most write parameters (<span class="tt">*_wrt</span>) on. Then, it searches through the silo files using <span class="tt">h5dump</span> to ensure that there are no <span class="tt">NaN</span>s or <span class="tt">Infinity</span>s. Although adding this option does not guarantee that accurate <span class="tt">.silo</span> files are generated, it does ensure that the post-process code does not fail or produce malformed data.</p>
<div style="text-align:center; font-size:0.75rem; color:#888; padding:16px 0 0;">Page last updated: 2026-02-15</div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
