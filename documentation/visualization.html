<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SY496B9L99"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SY496B9L99');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC: Flow visualization</title>
<meta name=”keywords” content="exascale, fluid dynamics, cfd, computational fluid dynamics, compressible, hpc, bryngelson, colonius, subgrid, multiphase, frontier, summit, el capitan, aurora, amd gpu, gpu, nvidia"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
// This file is set as MATHJAX_CODEFILE in the Doxyfile. It configures how
// MathJax renders expressions in Markdown so that it is consistent with GitHub.
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath:  [ ['$',  '$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      ignoreClass: "line" // Ignore code blocks: https://web.archive.org/web/20120430100225/http://www.mathjax.org/docs/1.1/options/tex2jax.html
    },
    "HTML-CSS": {
      fonts: ["TeX"]
    }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC
   </div>
   <div id="projectbrief">High-fidelity multiphase flow simulation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('visualization.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Flow visualization </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 class="doxsection"><a class="anchor" id="autotoc_md463"></a>
Flow visualization</h1>
<p>A post-processed database in Silo-HDF5 format can be visualized and analyzed using Paraview and VisIt. After the post-processing of simulation data (see section <a class="el" href="running.html" title="Running">Running</a>), a directory named <span class="tt">silo_hdf5</span> contains a silo-HDF5 database. Here, <span class="tt">silo_hdf5/</span> includes a directory named <span class="tt">root/</span> that contains index files for flow field data at each saved time step.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md464"></a>
Visualizing with Paraview</h3>
<p>Paraview is an open-source interactive parallel visualization and graphical analysis tool for viewing scientific data. Paraview 5.11.0 has been confirmed to work with the MFC databases for some parallel environments. Nevertheless, the installation and configuration of Paraview can be environment-dependent and are left to the user.</p>
<p>The user can launch Paraview and open the index files under <span class="tt">/silo_hdf5/root</span>. Once the database is loaded, flow field variables contained in the database can be added to the render view. Further information on Paraview can be found in its <a href="https://docs.paraview.org/en/latest/">documentation</a>. The figure below shows the iso-contour of the liquid void fraction (<span class="tt">alpha1</span>) in the database generated by the example case <span class="tt">3D_sphbubcollapse</span>.</p>
<p><img src="../res/paraview.png" alt="" class="inline"/></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md465"></a>
Visualizing data in cylindrical coordinates</h3>
<p>Visualizing data in cylindrical coordinates requires a coordinate transformation of the raw data in the database file. In Paraview, this coordinate transformation can be accomplished with the following steps:</p>
<ol type="1">
<li>Apply a <span class="tt">clean to grid</span> filter to the raw data</li>
<li>Apply a <span class="tt">calculator</span> filter to the cleaned data<ul>
<li>Set the calculator <span class="tt">attribute type</span> to point data</li>
<li>Check the box for <span class="tt">Coordinate Results</span></li>
<li>Enter the formula <span class="tt">coordsX*cos(coordsY)*iHat + coordsX*sin(coordsY)*jHat + coordsZ*kHat</span></li>
<li>click apply</li>
</ul>
</li>
</ol>
<p>These steps will transform the raw data into cylindrical coordinates. For many cases, this step will require resizing the render view window.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md466"></a>
Visualizing with VisIt</h2>
<p>VisIt is an alternative open-source interactive parallel visualization and graphical analysis tool for viewing scientific data. Versions of VisIt after 2.6.0 have been confirmed to work with the MFC databases for some parallel environments. Nevertheless, installation and configuration of VisIt can be environment-dependent and are left to the user. Further remarks on parallel flow visualization, analysis, and processing of the MFC database using VisIt can also be found in <a class="el" href="references.html" title="References">Coralic (2015)</a> and <a class="el" href="references.html" title="References">Meng (2016)</a>.</p>
<p>The user can launch VisIt and open the index files under <span class="tt">/silo_hdf5/root</span>. Once the database is loaded, flow field variables contained in the database can be added to the plot. The figure below shows the iso-contour of the liquid void fraction (<span class="tt">alpha1</span>) in the database generated by the example case <span class="tt">3D_sphbubcollapse</span>. For analysis and processing of the database using VisIt's capability, the user is encouraged to address <a href="https://wci.llnl.gov/simulation/computer-codes/visit/manuals">VisIt user manual</a>.</p>
<p><img src="../res/visit.png" alt="" class="inline"/></p>
<p><em>Iso-contour of the liquid void fraction (<span class="tt">alpha1</span>) in the database generated by example case <span class="tt">3D_sphbubcollapse</span></em></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md467"></a>
Serial data output</h2>
<p>If <span class="tt">parallel_io = 'F'</span>, MFC will output the conservative variables to a directory <span class="tt">D/</span>. If multiple cores are used ($\mathtt{ppn &gt; 1}$), then a separate file is created for each core. If only one coordinate dimension (<span class="tt">n = 0</span> and <span class="tt">p = 0</span>) exists, the primitive variables will also be written to <span class="tt">D/</span>. The file names correspond to the variables associated with each equation solved by MFC. They are written at every <span class="tt">t_step_save</span> time step. The conservative variables are</p>
<p>$$ {(\rho \alpha)}_{1}, \dots, (\rho\alpha)_{N_c}, \rho u_{1}, \dots, \rho u_{N_d}, E, \alpha_1, \dots, \alpha_{N_c} $$</p>
<p>and the primitive variables are</p>
<p>$$ {(\rho \alpha)}_1, \dots, (\rho\alpha)_{N_c}, u_1, \dots, u_{N_d}, p, \alpha_1, \dots, \alpha_{N_c} $$</p>
<p>where $N_c$ are the number of components <span class="tt">num_fluids</span> and $N_d$ is the number of spatial dimensions. There are exceptions: if <span class="tt">model_eqns = 3</span>, then the six-equation model appends these variables with the internal energies of each component. If there are sub-grid bubbles <span class="tt">bubbles = T</span>, then the bubble variables are also written. These depend on the bubble dynamics model used. If <span class="tt">polytropic = 'T'</span>, then the conservative variables are appended by</p>
<p>$$ n_b R_1, n_b {\dot R}_1, \dots, n_b R_{N_b}, n_b {\dot R}_{N_b} $$</p>
<p>where $n_B$ is the bubble number density, and $N_b$ is the number of bubble sizes (see the matching variable in the input file, <span class="tt">Nb</span>). The primitive bubble variables do not include $n_B$:</p>
<p>$$ R_1, {\dot R}_1, \dots, R_{N_b}, {\dot R}_{N_b} $$</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md468"></a>
Remote Visualization on PACE Phoenix</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md469"></a>
Step 1: Setting up your Environment</h3>
<p>Begin by downloading the <span class="tt">.zip</span> file <a href="https://www.dropbox.com/scl/fi/bdk8702oas8zqu0mk24vx/paceParaview.zip?rlkey=bov1s6lra0z7dhhrh6etniucx&amp;st=2m9xvls4&amp;dl=0">here</a>. This file contains two things:</p>
<ul>
<li>A bash script to automate the job submission process and provide instructions for remote connection</li>
<li>A prebuilt Paraview 5.11 binary</li>
</ul>
<p>Place the file <span class="tt">paceParview.zip</span> in your scratch direction on Phoenix and unzip it using <span class="tt">unzip paceParaview.zip</span>. Enter the new directory <span class="tt">paceParaview</span> and run <span class="tt">tar -xvf ParaView-5.11.0-egl-MPI-Linux-Python3.9-x86_64.tar.gz</span> to decompress the compiled binary. Now that you have the binary on Phoenix, you must download Paraview 5.11 on your local machine. Paraview binaries can be downloaded <a href="https://www.paraview.org/download/">here</a>. Select <span class="tt">v5.11</span> from the version drop-down bar and install a <span class="tt">5.11.0</span> version of Paraview.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md470"></a>
Step 2: Customizing the script</h3>
<p>While all of the bash script's options could be passed as command-line arguments, hardcoding certain unlikely-to-change options saves time. The following is a list of required and suggested updates to make to <span class="tt">pace-paraview-server</span>.</p>
<ul>
<li>(Optional) Update line 4 to customize the job name that will show up in the scheduler</li>
<li>(Required) Update line 6 to point towards the location of your Paraview bin directory</li>
<li>(Optional) Update line 51 to reflect the default account you'll use to run Paraview jobs</li>
<li>(Optional) Update line 52 to reflect the default wall time requested for your job</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md471"></a>
Step 3: Running pace-paraview-server</h3>
<p>Before running <span class="tt">pace-paraview-server</span> for the first time, you must update its permissions by running <span class="tt">chmod u+x pace-paraview-server</span> in your command line. Once this has been done, you can run <span class="tt">./pace-paraview-server</span> with the following options:</p>
<ul>
<li><span class="tt">--account</span> specifies the charge account for the job. If you updated line 51 of <span class="tt">pace-paraview-server</span> to reflect a default account, this option is optional; otherwise, it is required.</li>
<li><span class="tt">--nodes</span> specifies the number of nodes to request (default 1)</li>
<li><span class="tt">--mem</span> specifies the memory per node to request (default is to request all memory)</li>
<li><span class="tt">--gres</span> specifies the GPU resources to request. These instructions have only been verified to work with <span class="tt">--gres gpu:V100:2</span>.</li>
<li><span class="tt">--time</span> specifies the time limit for your job. This is optional and defaults to whatever is set on line 52 of <span class="tt">pace-paraview-server</span>.</li>
</ul>
<p>Once you run <span class="tt">./pace-paraview-server &lt;options&gt;</span>, it'll take a bit to start up. In the meantime, you'll see the below message:</p>
<div class="fragment"><div class="line">Submitted batch job &lt;job #&gt;</div>
<div class="line">Waiting for ParaView server to start. This may take several minutes  ...</div>
</div><!-- fragment --><p>When initializing is done, you should see a dialogue with some recommended next steps, numbered 1-4. Below is a slightly altered version of that dialogue:</p>
<p>1) Create the appropriate port forwarding for your local ParaView session to connect with.</p><ul>
<li>On your local machine, run the following from a terminal: <span class="tt">nodeIdentifier</span> is the remote node running the ParaView server process (given in the output of the batch script), and <span class="tt">paceSystemIdentifier</span> is the name of the PACE system (however, this is configured with your <span class="tt">.ssh/config</span>).</li>
<li>This terminal session must not be killed for your ParaView session as it maintains the port forwarding.<ul>
<li><span class="tt">ssh -L 8722:&lt;nodeIdentifier&gt;:53723 &lt;paceSystemIdentifier&gt;</span></li>
</ul>
</li>
</ul>
<p>2) Once you have <span class="tt">Paraview5.11.0</span> on your machine, select <span class="tt">File -&gt; Connect..</span> to open the remote connection dialogue box.</p><ul>
<li>Double-click the existing configuration if you've already set up the PACE connection.</li>
<li>Click <span class="tt">Add Server</span> If you have not set up the PACE connection. This will create a new dialogue box where you can specify a configuration name and set the <span class="tt">Port</span> to <span class="tt">8722</span>. Once this is done, click <span class="tt">configure</span> and then <span class="tt">save</span> on the next dialogue box. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
